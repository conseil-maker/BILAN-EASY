# =============================================================================
# BILAN-EASY CI/CD Pipeline
# =============================================================================
# Ce workflow s'ex√©cute sur chaque push et pull request vers main
# Il v√©rifie la qualit√© du code avant le d√©ploiement sur Vercel
# =============================================================================
name: CI/CD Pipeline
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
env:
  NODE_VERSION: '20'
jobs:
  # ===========================================================================
  # JOB 1: V√©rification du code (lint, types, build)
  # ===========================================================================
  quality:
    name: "\U0001F50D Quality Check"
    runs-on: ubuntu-latest
    
    steps:
      - name: "\U0001F4E5 Checkout code"
        uses: actions/checkout@v4

      - name: "\U0001F4E6 Setup Node.js"
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: "\U0001F4E6 Setup pnpm"
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: "\U0001F4DA Install dependencies"
        run: pnpm install --frozen-lockfile

      - name: "\U0001F527 TypeScript Check"
        run: pnpm build
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL || 'https://placeholder.supabase.co' }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY || 'placeholder-key' }}

      - name: "\U0001F4CA Check bundle size"
        run: |
          echo "üìä Bundle size analysis:"
          du -sh dist/
          echo ""
          echo "üìÅ Largest chunks:"
          ls -lhS dist/assets/*.js | head -10

  # ===========================================================================
  # JOB 2: Notification de succ√®s
  # ===========================================================================
  notify:
    name: "\u2705 Pipeline Complete"
    runs-on: ubuntu-latest
    needs: [quality]
    if: success()
    
    steps:
      - name: "\U0001F389 Success notification"
        run: |
          echo "‚úÖ CI/CD Pipeline completed successfully!"
          echo ""
          echo "üìã Summary:"
          echo "  - Quality checks: ‚úÖ Passed"
          echo "  - Build: ‚úÖ Successful"
          echo ""
          echo "üöÄ Ready for deployment via Vercel"
